# Dart 物件導向基礎

> 課程日期：114/11/24
> 對應檔案：`1141124.txt`

---

## 教學重點

### 1. 初始化列表 (Initializer List)

用於在建構子主體執行前初始化成員變數，特別適用於 `final` 成員。

```dart
class Point {
  final int x;
  final int y;

  // 使用初始化列表
  Point(int a, int b) : x = a, y = b;

  // 計算後初始化
  Point.calculate(int a, int b) : x = a + b, y = a * b;
}

class Rectangle {
  final int width;
  final int height;
  final int area;

  // 初始化列表可使用其他參數計算
  Rectangle(this.width, this.height) : area = width * height;
}
```

**final 成員初始化方式：**
```dart
class Person {
  final String name;
  final int age;

  // 方式1：直接初始化
  Person(this.name, this.age);

  // 方式2：初始化列表
  Person.init(String n, int a) : name = n, age = a;

  // 方式3：具名參數 + 預設值
  Person.named({required this.name, this.age = 0});

  // 方式4：具名參數 + null 合併
  Person.nullable({String? name, int? age})
      : name = name ?? 'Unknown',
        age = age ?? 0;
}
```

### 2. 重定向建構子 (Redirecting Constructor)

```dart
class Point {
  double x, y;

  Point(this.x, this.y);

  // 重定向到主建構子
  Point.alongXAxis(double x) : this(x, 0);
  Point.alongYAxis(double y) : this(0, y);

  // 重定向到具名建構子
  Point.internal(this.y) : x = 5;
  Point.origin() : this(0, 0);
}

void main() {
  var p1 = Point.alongXAxis(3);  // (3, 0)
  var p2 = Point.origin();       // (0, 0)
}
```

### 3. 常數建構子 (Const Constructor)

```dart
class Student {
  final String name;
  final int age;

  const Student(this.name, this.age);  // 常數建構子
}

void main() {
  // 使用 const 建立相同值的物件會是同一個實例
  const s1 = Student('Ada', 22);
  const s2 = Student('Ada', 22);
  print(identical(s1, s2));  // true

  // 不使用 const 則是不同實例
  var s3 = Student('Ada', 22);
  var s4 = Student('Ada', 22);
  print(identical(s3, s4));  // false
}
```

### 4. 工廠建構子 (Factory Constructor)

工廠建構子可以回傳已存在的實例或子類別實例。

```dart
class Person {
  String name;
  String color;
  static final Map<String, Person> _cache = {};

  Person(this.name, this.color);

  // 工廠建構子：快取已建立的實例
  factory Person.withName(String name) {
    if (_cache.containsKey(name)) {
      return _cache[name]!;
    } else {
      final p = Person(name, 'default');
      _cache[name] = p;
      return p;
    }
  }
}

void main() {
  final p1 = Person.withName('Ada');
  final p2 = Person.withName('Ada');
  print(identical(p1, p2));  // true (回傳同一個實例)
}
```

**工廠建構子回傳子類別：**
```dart
class Dog {
  String name;
  Dog(this.name);

  factory Dog.createDog({required String name, bool guardDog = false}) {
    if (guardDog)
      return Doberman(name);
    else
      return Labrador(name);
  }
}

class Doberman extends Dog {
  Doberman(String name) : super(name);
}

class Labrador extends Dog {
  Labrador(String name) : super(name);
}
```

### 5. 單例模式 (Singleton)

```dart
// 方式1：使用 static 方法
class Singleton1 {
  static Singleton1? _instance;

  Singleton1._internal();

  static Singleton1 getInstance() {
    _instance ??= Singleton1._internal();
    return _instance!;
  }
}

// 方式2：使用 getter
class Singleton2 {
  static Singleton2? _instance;

  Singleton2._internal();

  static Singleton2 get instance {
    _instance ??= Singleton2._internal();
    return _instance!;
  }
}

// 方式3：使用 factory (推薦)
class Singleton3 {
  static final Singleton3 _instance = Singleton3._internal();

  Singleton3._internal();

  factory Singleton3() => _instance;
}

void main() {
  var s1 = Singleton3();
  var s2 = Singleton3();
  print(identical(s1, s2));  // true
}
```

### 6. 運算子重載 (Operator Overloading)

```dart
class Vector {
  num x, y;
  Vector(this.x, this.y);

  // 重載 + 運算子
  Vector operator +(Vector v) => Vector(x + v.x, y + v.y);

  // 重載 - 運算子
  Vector operator -(Vector v) => Vector(x - v.x, y - v.y);

  void print() => print('($x, $y)');
}

void main() {
  Vector v1 = Vector(1, 2);
  Vector v2 = Vector(3, 4);

  var v3 = v1 + v2;  // (4, 6)
  var v4 = v2 - v1;  // (2, 2)
}
```

**可重載的運算子：**
`+`, `-`, `*`, `/`, `%`, `^`, `~/`, `>`, `<`, `>=`, `<=`, `>>`, `<<`, `&`, `|`, `[]`, `~`

### 7. 列舉 (Enumeration)

```dart
enum Colors { red, green, blue }

void main() {
  final color = Colors.red;

  // switch 搭配 enum
  switch (color) {
    case Colors.red:
      print('Red');
      break;
    case Colors.green:
      print('Green');
      break;
    case Colors.blue:
      print('Blue');
      break;
  }

  // 取得所有值
  print(Colors.values);        // [Colors.red, Colors.green, Colors.blue]
  print(Colors.values[0]);     // Colors.red
  print(Colors.red.index);     // 0
}
```

### 8. Static 成員

```dart
class Car {
  String? type;
  int? maxSpeed;

  // 具名建構子
  Car.executor1() {
    type = 'Camry';
    maxSpeed = 230;
    print('Created!');
  }

  // static 方法：不需實例即可呼叫
  static void executor2() {
    print('Static method!');
  }
}

void main() {
  Car.executor2();  // 直接呼叫 static 方法

  var car = Car.executor1();
  print(car.type);  // Camry
}
```

---

## 繼承進階

### super 呼叫具名建構子

```dart
class Student {
  int age;
  int id;
  Student(this.age, this.id);
  Student.fromJson(Map data) {
    print('Student: $data');
  }
}

class John extends Student {
  // 呼叫父類別的具名建構子
  John.fromJson(Map data) : super.fromJson(data) {
    print('John: $data');
  }
}

void main() {
  John.fromJson({'name': 'John'});
  // Student: {name: John}
  // John: {name: John}
}
```

---

## 建構子類型總覽

| 類型 | 語法 | 用途 |
|------|------|------|
| 預設建構子 | `ClassName()` | 基本初始化 |
| 具名建構子 | `ClassName.name()` | 多種初始化方式 |
| 重定向建構子 | `: this()` | 呼叫其他建構子 |
| 常數建構子 | `const ClassName()` | 編譯時常數物件 |
| 工廠建構子 | `factory ClassName()` | 回傳快取或子類別實例 |

---

## 學習要點總結

- [ ] 使用初始化列表初始化 `final` 成員
- [ ] 使用 `: this()` 建立重定向建構子
- [ ] 使用 `const` 建構子建立編譯時常數物件
- [ ] 使用 `factory` 建構子實作快取或回傳子類別
- [ ] 實作單例模式 (Singleton)
- [ ] 使用 `operator` 關鍵字重載運算子
- [ ] 使用 `enum` 定義列舉型別
- [ ] 了解 `static` 成員的使用時機
- [ ] 使用 `super.namedConstructor()` 呼叫父類別具名建構子
