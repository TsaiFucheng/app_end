# Dart 函式進階與物件導向入門

> 課程日期：114/11/17
> 對應檔案：`1141117.txt`

---

## 教學重點

### 1. 可選具名參數 (Optional Named Parameters)

```dart
// 位置參數 (Positional) - 必須按順序傳入
p1(x, y) => print('x=$x y=$y');

// 具名參數 (Named) - 用 {} 包住，可任意順序
p2({x, y}) => print('x=$x y=$y');

// 混合使用
void p3(int a, int b, {int c = 99}) => print(a + b + c);
void p4(int a, int b, {int c = 99, int d = 100}) => print(a + b + c + d);

void main() {
  p1(123, 456);              // x=123 y=456
  p2(y: 456, x: 123);        // x=123 y=456 (順序不重要)
  p2(x: 123);                // x=123 y=null

  p3(1, 2);                  // 102 (c 用預設值)
  p3(1, 2, c: 3);            // 6

  p4(1, 2, d: 4, c: 3);      // 10
}
```

### 2. required 關鍵字

```dart
// 沒有 required - 可以不傳
sayHello1({String? name}) => print("Hello $name");

// 有預設值
sayHello2({name = 'Bob'}) => print("Hello $name");

// 必須傳入
sayHello3({required String name}) => print("Hello $name");

void main() {
  sayHello1();              // Hello null
  sayHello2();              // Hello Bob
  // sayHello3();           // 錯誤！name 是必須的
  sayHello3(name: 'Ada');   // Hello Ada
}
```

### 3. 函式作為物件/參數

```dart
printNum(int a) => print('$a');

// 函式作為參數
void test(Function func) {
  func();
}

void main() {
  // 將函式賦值給變數
  var f1 = printNum;
  Function f2 = printNum;
  var f3 = (int a) => print('$a');

  f1(1);
  f2(2);
  f3(3);

  // 使用 forEach 傳入函式
  var arr = [1, 2, 3];
  arr.forEach(printNum);

  // 匿名函式作為參數
  test(() => print('Anonymous'));
  test(() {
    print('Block anonymous');
    return 10;
  });
}
```

### 4. typedef 函式型別

```dart
// 定義函式型別
typedef Calculate = int Function(int n1, int n2);

// 使用 typedef 作為參數型別
int compute(Calculate calc) {
  return calc(20, 30);
}

// 使用 typedef 作為回傳型別
Calculate getOperation() {
  return (n1, n2) => n1 * n2;
}

void main() {
  var sum = compute((n1, n2) => n1 + n2);
  print(sum);  // 50

  Calculate multiply = getOperation();
  print(multiply(3, 4));  // 12
}
```

### 5. 遞迴 (Recursion)

```dart
// 階乘
int factorial(int n) {
  if (n <= 1) return 1;
  else return n * factorial(n - 1);
}

// 費氏數列
int fibonacci(int n) {
  if (n <= 1) return n;
  else return fibonacci(n - 1) + fibonacci(n - 2);
}

void main() {
  print(factorial(8));  // 40320
  print(fibonacci(8));  // 21
}
```

---

## 物件導向基礎 (OOP Basics)

### 1. 類別定義

```dart
class Circle {
  final pi = 3.14159;
  int r = 0;

  // 建構子
  Circle(int radius) {
    r = radius;
  }

  // 方法
  int area() => r * r;
  double volume() => 4 / 3 * r * r * r;
}

void main() {
  Circle c1 = Circle(5);
  print(c1.area());     // 25
  print(c1.volume());   // 166.67
}
```

### 2. 私有成員 (Private Members)

```dart
// car.dart
class Car {
  late int _price;    // 私有 (底線開頭)
  int _year = 2020;

  Car(int price) {
    _price = price;
  }

  // Getter
  int get price => _price;

  // Setter
  set price(int value) => _price = value;
}

// main.dart
import 'car.dart';

void main() {
  Car c = Car(50000);
  // print(c._price);    // 錯誤！私有成員無法從外部存取
  print(c.price);        // 50000 (透過 getter)
  c.price = 60000;       // 透過 setter
}
```

### 3. Getter 和 Setter

```dart
class Rectangle {
  num left, top, width, height;

  Rectangle(this.left, this.top, this.width, this.height);

  // 計算屬性 (Getter)
  num get right => left + width;
  num get bottom => top + height;
  num get area => width * height;

  // Setter
  set right(num value) => left = value - width;
  set bottom(num value) => top = value - height;
}

void main() {
  var rect = Rectangle(0, 0, 100, 50);
  print(rect.area);   // 5000

  rect.right = 150;   // 透過 setter 調整 left
  print(rect.left);   // 50
}
```

---

## 繼承 (Inheritance)

### 1. 基本繼承

```dart
class Animal {
  void eat() => print('Animal can eat.');
}

class Dog extends Animal {
  void bark() => print('Dog can bark.');

  // 覆寫父類別方法
  @override
  void eat() => print('Dog can eat.');

  void demo() {
    this.eat();    // Dog can eat.
    super.eat();   // Animal can eat.
  }
}

void main() {
  Dog d = Dog();
  d.eat();    // Dog can eat.
  d.bark();   // Dog can bark.
}
```

### 2. super 呼叫父建構子

```dart
class Parent {
  String name;
  Parent(this.name) {
    print('Parent: $name');
  }
}

class Child extends Parent {
  int age;

  // 使用 super 呼叫父建構子
  Child(String name, this.age) : super(name) {
    print('Child: age=$age');
  }
}

void main() {
  Child c = Child('Ada', 20);
  // 輸出：
  // Parent: Ada
  // Child: age=20
}
```

### 3. 方法覆寫 (Override)

```dart
class Person {
  String name;
  Person(this.name);

  void greet() => print('Hello, I am $name');
}

class Student extends Person {
  int score;

  Student(String name, this.score) : super(name);

  @override
  void greet() {
    super.greet();  // 呼叫父類別方法
    print('My score is $score');
  }
}

void main() {
  Student s = Student('Bob', 90);
  s.greet();
  // Hello, I am Bob
  // My score is 90
}
```

---

## 具名建構子 (Named Constructor)

```dart
class Cat {
  late String name;
  late String color;

  // 預設建構子
  Cat(this.name, this.color);

  // 具名建構子
  Cat.orange(this.name) {
    color = 'Orange';
  }

  Cat.black(this.name) {
    color = 'Black';
  }

  // 從 Map 建構
  Cat.fromJson(Map<String, dynamic> json) {
    name = json['name'];
    color = json['color'];
  }

  @override
  String toString() => 'Cat: $name, $color';
}

void main() {
  print(Cat('Kitty', 'White'));              // Cat: Kitty, White
  print(Cat.orange('Garfield'));             // Cat: Garfield, Orange
  print(Cat.black('Shadow'));                // Cat: Shadow, Black
  print(Cat.fromJson({'name': 'Luna', 'color': 'Grey'}));  // Cat: Luna, Grey
}
```

### origin 具名建構子模式

```dart
class Point {
  num? x, y;

  Point(this.x, this.y);

  // 原點建構子
  Point.origin() {
    x = 0;
    y = 0;
  }

  void print1() => print('($x, $y)');
}

void main() {
  var p1 = Point.origin();
  p1.print1();  // (0, 0)

  var p2 = Point(1, 2);
  p2.print1();  // (1, 2)
}
```

---

## 常用模式整理

### 建構子簡寫

```dart
class Person {
  String name;
  int age;

  // 完整寫法
  // Person(String name, int age) {
  //   this.name = name;
  //   this.age = age;
  // }

  // 簡寫
  Person(this.name, this.age);
}
```

### 初始化列表

```dart
class Point {
  final int x;
  final int y;

  // 使用初始化列表
  Point(int a, int b) : x = a, y = b;

  // 搭配 super
  // Child(int value) : _x = value, super(value);
}
```

---

## 學習要點總結

- [ ] 區分位置參數和具名參數的差異
- [ ] 使用 `required` 標記必要的具名參數
- [ ] 將函式作為變數或參數使用
- [ ] 使用 `typedef` 定義函式型別
- [ ] 實作遞迴函式 (階乘、費氏數列)
- [ ] 使用底線 `_` 定義私有成員
- [ ] 實作 getter 和 setter
- [ ] 使用 `extends` 繼承類別
- [ ] 使用 `super` 呼叫父類別
- [ ] 使用 `@override` 覆寫方法
- [ ] 建立具名建構子
