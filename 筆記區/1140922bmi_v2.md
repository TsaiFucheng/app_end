# Flutter 進階 - BMI 計算器 v2

> 課程日期：114/09/22
> 對應專案：`1140922bmi_v2/`

---

## 教學重點

### 1. 應用程式初始化與螢幕方向鎖定

```dart
import 'dart:async';
import 'package:flutter/services.dart';

void main() {
  WidgetsFlutterBinding.ensureInitialized();  // 確保 Flutter 綁定初始化
  SystemChrome.setPreferredOrientations([     // 鎖定螢幕方向
    DeviceOrientation.portraitUp,
    DeviceOrientation.portraitDown,
  ]);
  runApp(const MyApp());
}
```

**重點說明：**
- `WidgetsFlutterBinding.ensureInitialized()` - 在 `runApp()` 前呼叫原生功能時必須先初始化
- `SystemChrome.setPreferredOrientations()` - 限制 App 只能直向顯示

### 2. 啟動頁面 (Splash Screen) 設計

```dart
class Screen1 extends StatefulWidget {
  const Screen1({super.key});

  @override
  State<Screen1> createState() => _Screen1State();
}

class _Screen1State extends State<Screen1> {
  String image1 = "images/1140922bc.png";

  @override
  void initState() {
    super.initState();
    Timer(Duration(seconds: 3), () {  // 3秒後自動跳轉
      Navigator.push(
        context,
        MaterialPageRoute(builder: (context) => MyHomePage(title: "Flutter demo 1"))
      );
    });
  }
  // ...
}
```

**重點說明：**
- 使用 `Timer` 實現延遲自動跳轉
- `initState()` 是 Widget 初始化時執行的方法

### 3. 頁面導航 (Navigation)

```dart
// 方式一：使用 Timer 自動跳轉
Timer(Duration(seconds: 3), () {
  Navigator.push(context, MaterialPageRoute(builder: (context) => MyHomePage(title: "...")));
});

// 方式二：按鈕點擊跳轉
ElevatedButton(
  onPressed: () => Navigator.push(
    context,
    MaterialPageRoute(builder: (context) => MyHomePage(title: "Flutter demo 1"))
  ),
  child: Text("開始"),
),
```

**Navigator 常用方法：**
| 方法 | 說明 |
|------|------|
| `Navigator.push()` | 推入新頁面 (可返回) |
| `Navigator.pop()` | 返回上一頁 |
| `Navigator.pushReplacement()` | 替換當前頁面 (不可返回) |

### 4. BoxDecoration 容器裝飾

```dart
Container(
  width: 200,
  height: 200,
  decoration: BoxDecoration(
    border: Border.all(
      color: Colors.purple,
      width: 5,
      style: BorderStyle.solid,
    ),
    borderRadius: BorderRadius.circular(30),  // 圓角
    image: DecorationImage(image: AssetImage(image1)),  // 背景圖片
    color: Colors.white,
  ),
),
```

**BoxDecoration 屬性：**
| 屬性 | 說明 |
|------|------|
| `border` | 邊框設定 |
| `borderRadius` | 圓角半徑 |
| `image` | 背景圖片 |
| `color` | 背景顏色 |
| `boxShadow` | 陰影效果 |
| `gradient` | 漸層效果 |

### 5. AlertDialog 錯誤對話框

```dart
showDialog(
  context: context,
  builder: (context) {
    return AlertDialog(
      title: Text("警告"),
      content: Text("身高體重不得為空!"),
      actions: [
        TextButton(
          onPressed: () => Navigator.pop(context),  // 關閉對話框
          child: Text("了解"),
        ),
      ],
    );
  }
);
```

**AlertDialog 結構：**
- `title` - 對話框標題
- `content` - 對話框內容
- `actions` - 按鈕列表 (通常放在底部)

### 6. Visibility Widget 條件顯示

```dart
bool visible1 = true;

// 根據驗證結果決定是否顯示
visible1 = (validateh || validatew) ? false : true;

Visibility(
  visible: visible1,  // true 顯示，false 隱藏
  child: Container(
    // 結果顯示區域
  ),
),
```

**Visibility vs Offstage：**
| Widget | visible=false 時 |
|--------|------------------|
| `Visibility` | 保留空間，只是不可見 |
| `Offstage` | 不保留空間，完全移除 |

### 7. 自訂字型

```dart
Text(
  "我的BMI程式",
  style: TextStyle(
    fontSize: 36,
    color: Colors.amber,
    fontWeight: FontWeight.bold,
    fontFamily: "kai",  // 使用自訂字型
  ),
),
```

**設定步驟：**
1. 在 `pubspec.yaml` 中宣告字型
2. 將字型檔放入 `fonts/` 資料夾
3. 在 `TextStyle` 中使用 `fontFamily`

**pubspec.yaml 配置範例：**
```yaml
flutter:
  assets:
    - images/          # 圖片資源資料夾

  fonts:
    - family: kai      # 字型家族名稱
      fonts:
        - asset: fonts/kai.ttf  # 字型檔路徑
```

### 8. Center Widget 置中

```dart
body: Center(
  child: Column(
    mainAxisAlignment: MainAxisAlignment.center,
    children: [...],
  ),
),
```
- `Center` 可將子元件在父容器中水平和垂直置中

### 9. TextAlign 文字對齊

```dart
Text(
  "我的BMI程式",
  textAlign: TextAlign.center,  // 文字置中對齊
  style: TextStyle(...),
),
```

**TextAlign 選項：**
| 值 | 說明 |
|----|------|
| `TextAlign.left` | 靠左 |
| `TextAlign.center` | 置中 |
| `TextAlign.right` | 靠右 |
| `TextAlign.justify` | 兩端對齊 |

---

## 程式架構

```
MyApp (StatelessWidget)
  └── MaterialApp
        └── Screen1 (啟動頁面)
              │
              └── [導航] → MyHomePage (計算頁面)
```

### 頁面流程

```
┌─────────────┐     3秒後自動      ┌─────────────┐
│   Screen1   │  ───────────────→  │  MyHomePage │
│  (啟動頁面)  │   或點擊「開始」   │  (計算頁面)  │
└─────────────┘                    └─────────────┘
```

---

## v1 vs v2 功能比較

| 功能 | v1 | v2 |
|------|:--:|:--:|
| BMI 計算 | ✓ | ✓ |
| 輸入驗證 | ✓ | ✓ |
| 結果顏色標示 | ✓ | ✓ |
| 啟動頁面 | ✗ | ✓ |
| 頁面導航 | ✗ | ✓ |
| 螢幕方向鎖定 | ✗ | ✓ |
| AlertDialog 錯誤提示 | ✗ | ✓ |
| Visibility 條件顯示 | ✗ | ✓ |
| 自訂字型 | ✗ | ✓ |
| 圖片裝飾 | ✗ | ✓ |

---

## 使用的 Widget 清單

| Widget | 用途 |
|--------|------|
| `Timer` | 延遲執行 (來自 dart:async) |
| `Navigator` | 頁面導航 |
| `MaterialPageRoute` | Material 風格頁面路由 |
| `BoxDecoration` | 容器裝飾 |
| `DecorationImage` | 裝飾用圖片 |
| `AssetImage` | 載入資源圖片 |
| `AlertDialog` | 對話框 |
| `Visibility` | 條件顯示/隱藏 |
| `Center` | 置中對齊 |
| `TextButton` | 文字按鈕 (用於 AlertDialog) |

---

## 學習要點總結

- [ ] 了解 `WidgetsFlutterBinding.ensureInitialized()` 的用途
- [ ] 使用 `SystemChrome` 鎖定螢幕方向
- [ ] 使用 `Timer` 實現延遲操作
- [ ] 掌握 `Navigator.push()` 和 `Navigator.pop()` 頁面導航
- [ ] 使用 `BoxDecoration` 裝飾 Container
- [ ] 使用 `AlertDialog` 顯示錯誤訊息
- [ ] 使用 `Visibility` 控制 Widget 顯示/隱藏
- [ ] 了解自訂字型的設定方式
- [ ] 在 pubspec.yaml 中配置 assets 和 fonts
- [ ] 使用 `Center` Widget 置中元件
- [ ] 使用 `TextAlign` 控制文字對齊
