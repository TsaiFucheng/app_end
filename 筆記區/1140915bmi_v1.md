# Flutter 基礎 - BMI 計算器 v1

> 課程日期：114/09/15
> 對應專案：`1140915bmi_v1/`

---

## 教學重點

### 1. Flutter 應用程式結構

```dart
void main() {
  runApp(const MyApp());  // 應用程式進入點
}
```

- `main()` 是 Dart 程式的進入點
- `runApp()` 啟動 Flutter 應用

### 2. StatelessWidget vs StatefulWidget

| 類型 | 說明 | 使用時機 |
|------|------|---------|
| **StatelessWidget** | 無狀態元件，不會改變 | 靜態畫面 (如 Logo、標題) |
| **StatefulWidget** | 有狀態元件，可動態更新 | 需要互動的畫面 |

```dart
// StatelessWidget 範例
class MyApp extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return MaterialApp(...);
  }
}

// StatefulWidget 範例
class MyHomePage extends StatefulWidget {
  @override
  State<MyHomePage> createState() => _MyHomePageState();
}
```

### 3. TextEditingController 文字輸入控制器

```dart
TextEditingController heightController = TextEditingController();
TextEditingController weightController = TextEditingController();
```

**重要：需在 `dispose()` 中釋放資源**
```dart
@override
void dispose() {
  super.dispose();
  heightController.dispose();
  weightController.dispose();
}
```

### 4. TextField 輸入框

```dart
TextField(
  controller: heightController,        // 綁定控制器
  keyboardType: TextInputType.number,  // 數字鍵盤
  decoration: InputDecoration(
    labelText: '請輸入身高',           // 標籤文字
    hintText: 'cm',                    // 提示文字
    errorText: validateh? "不得為空":null,  // 錯誤訊息
    icon: Icon(Icons.trending_up),     // 前置圖示
  ),
  style: TextStyle(fontSize: 22),
),
```

### 5. setState() 狀態更新

```dart
setState(() {
  // 在這裡修改狀態變數
  // Flutter 會自動重新建構 UI
  calculateBMI();
});
```

### 6. Nullable 變數 (Null Safety)

```dart
double? result;      // 可為 null 的 double
String? bmi_status;  // 可為 null 的 String

// 使用 null check
result!  // 強制解包 (確定不為 null 時)
result?  // 安全存取 (可能為 null)
```

### 7. RichText 混合樣式文字

```dart
RichText(
  text: TextSpan(
    style: TextStyle(color: Colors.blue, fontSize: 22),
    children: [
      TextSpan(text: "您的體重狀態為:"),
      TextSpan(
        text: "${bmi_status}",
        style: TextStyle(color: getTextColor(bmi_status)),  // 動態顏色
      ),
    ],
  ),
),
```

---

## 關鍵程式碼

### BMI 計算邏輯
```dart
void calculateBMI() {
  if (heightController.text != "" && weightController.text != "") {
    double h = double.parse(heightController.text) / 100;  // cm → m
    double w = double.parse(weightController.text);
    result = w / (h * h);  // BMI 公式

    // BMI 分類
    if (result! < 18.5) {
      bmi_status = "過輕";
    } else if (result! >= 24) {
      bmi_status = "過重";
    } else {
      bmi_status = "正常";
    }
  }
}
```

### 根據狀態返回顏色
```dart
Color? getTextColor(String? s1) {
  if (s1 == "正常") return Colors.green;
  else if (s1 == "過輕") return Colors.amberAccent;
  else if (s1 == "過重") return Colors.red;
}
```

---

## 使用的 Widget 清單

| Widget | 用途 |
|--------|------|
| `MaterialApp` | 應用程式根容器 |
| `Scaffold` | 頁面基本結構 |
| `AppBar` | 頂部導航列 |
| `Container` | 容器 (設定 padding) |
| `Column` | 垂直排列子元件 |
| `TextField` | 文字輸入框 |
| `ElevatedButton` | 凸起按鈕 |
| `Text` | 文字顯示 |
| `RichText` | 混合樣式文字 |
| `SizedBox` | 間距控制 |
| `Icon` | 圖示 |

---

## 補充教學內容

### 8. Dart 常用語法

#### 三元運算子 (Ternary Operator)
```dart
// 語法：條件 ? 值1 : 值2
errorText: validateh ? "不得為空" : null,
result == null ? "" : "您的BMI值=${result?.toStringAsFixed(2)}"
```

#### 字串插值 (String Interpolation)
```dart
"您的BMI值=${result?.toStringAsFixed(2)}"  // 使用 ${expression}
"${bmi_status}"                             // 變數插入字串
```

#### 型別轉換
```dart
double.parse("123.45")    // 字串 → double
int.parse("123")          // 字串 → int
.toString()               // 數字 → 字串
.toStringAsFixed(2)       // 保留小數點後 2 位
```

#### 字串判斷
```dart
heightController.text.isEmpty   // 判斷字串是否為空
heightController.text != ""     // 另一種寫法
```

### 9. Layout 佈局屬性

#### EdgeInsets 間距設定
```dart
padding: EdgeInsets.symmetric(horizontal: 30),  // 左右各 30
// 其他用法：
// EdgeInsets.all(10)                    // 四邊相同
// EdgeInsets.only(left: 10, top: 20)    // 指定單邊
```

#### MainAxisAlignment 主軸對齊
```dart
Column(
  mainAxisAlignment: MainAxisAlignment.center,  // 垂直置中
  children: [...],
)
// 其他選項：
// MainAxisAlignment.start        // 起始位置
// MainAxisAlignment.end          // 結束位置
// MainAxisAlignment.spaceBetween // 平均分散
```

### 10. Widget 屬性補充

#### ThemeData 主題設定
```dart
MaterialApp(
  theme: ThemeData(
    colorScheme: ColorScheme.fromSeed(seedColor: Colors.deepPurple),
  ),
)
```

#### AppBar 屬性
```dart
AppBar(
  backgroundColor: Colors.amber,  // 背景顏色
  title: Text('BMI計算機'),       // 標題
  centerTitle: true,              // 標題置中
)
```

#### ElevatedButton 樣式
```dart
ElevatedButton(
  style: ElevatedButton.styleFrom(
    textStyle: TextStyle(fontSize: 20),
  ),
  onPressed: () {
    setState(() {
      // 按鈕點擊時執行的程式碼
    });
  },
  child: Text("計算"),
)
```

#### TextStyle fontWeight 屬性
```dart
fontWeight: FontWeight.w500,   // 中等粗細 (100-900)
fontWeight: FontWeight.bold,   // 粗體 (等同 w700)
```

### 11. Dart 3.0 新語法

#### const 構造函數
```dart
const MyApp({super.key});  // const 建構子可提升效能
```

#### super.key 簡化語法
```dart
// Dart 3.0 新語法
MyApp({super.key});

// 等同於舊寫法
MyApp({Key? key}) : super(key: key);
```

#### required 關鍵字
```dart
const MyHomePage({super.key, required this.title});
// required 表示此具名參數為必填
```

---

## 學習要點總結

- [ ] 了解 Flutter 應用程式基本結構
- [ ] 區分 StatelessWidget 與 StatefulWidget
- [ ] 使用 TextEditingController 管理輸入
- [ ] 使用 setState() 更新 UI
- [ ] 了解 Null Safety (?, !)
- [ ] 使用 RichText 顯示混合樣式文字
- [ ] 記得在 dispose() 釋放 Controller 資源
- [ ] 使用三元運算子簡化條件判斷
- [ ] 使用字串插值 ${} 組合字串
- [ ] 使用 double.parse() 進行型別轉換
- [ ] 使用 EdgeInsets 設定間距
- [ ] 使用 MainAxisAlignment 控制對齊
- [ ] 了解 Dart 3.0 的 super.key 語法
